# æ—¶é—´ç®¡ç†åŠ©æ‰‹


## åŠŸèƒ½

- âœ… å®æ—¶äº‘åŒæ­¥: ç™»é™†åï¼Œæ•°æ®å®æ—¶åŒæ­¥æ•°æ®åº“ï¼Œä»»ä¸€ç«¯ä¿®æ”¹æ•°æ®ï¼Œå…¶ä»–ç«¯åŒæ­¥æ˜¾ç¤º
- âœ… ç¦»çº¿åŒæ­¥: æ–­ç½‘åï¼Œä¾æ—§å¯ä»¥æ­£å¸¸ä½¿ç”¨è¯¥è½¯ä»¶ï¼Œåœ¨ç½‘ç»œæ¢å¤æ—¶ï¼Œè‡ªåŠ¨ä¸äº‘ç«¯å¯¹æ¯”ï¼ŒåŒæ­¥æ•°æ®
- âœ… å¾®ä¿¡è”åŠ¨: å…³è”å…¬ä¼—å·åï¼Œç”¨æˆ·å¯ä»¥ç›´æ¥å‘å¾®ä¿¡å…¬ä¼—å·å‘é€æ–‡æœ¬ä¿¡æ¯ï¼Œå³å¯è‡ªåŠ¨åˆ›å»ºä»»åŠ¡
- âœ… è·¨å¹³å°: ç›®å‰æ”¯æŒ ğŸ“±Androidã€ğŸ’»Windowsã€ğŸ§Linuxã€ğŸŒWebï¼ŒğŸè‹¹æœè®¾å¤‡éœ€è‡ªè¡Œç¼–è¯‘

### è´¦å·åŠŸèƒ½
- ç§»åŠ¨ç«¯: ä½¿ç”¨æ‰‹æœºå·ä¸€é”®ç™»é™†ï¼Œæ— éœ€é¢å¤–æ³¨å†Œè´¦å·
- æ¡Œé¢ç«¯/Webç«¯: ä½¿ç”¨æ‰‹æœºAPPæ‰«ç ç™»é™†

### ä»»åŠ¡åŠŸèƒ½
- åˆ›å»ºä»»åŠ¡: æ”¯æŒæ‰‹åŠ¨åˆ›å»ºã€AIè¯†åˆ«æ–‡æœ¬ä¿¡æ¯åˆ›å»º
- ç®¡ç†ä»»åŠ¡: æ”¯æŒæ‰‹åŠ¨ç¼–è¾‘
- é¢„è§ˆä»»åŠ¡: å¯ä»¥é€šè¿‡ä»¥â€œåˆ—è¡¨è§†å›¾â€ã€â€œå››è±¡é™åˆ†ç±»è§†å›¾â€å’Œâ€œæ—¥æœŸè§†å›¾â€è¿›è¡Œé¢„è§ˆ

### æ•°æ®éƒ¨åˆ†
- æ•°æ®å¤‡ä»½: å¯ä»¥ä»¥æ–‡ä»¶å½¢å¼ã€æ–‡æœ¬å½¢å¼å¯¼å…¥å¯¼å‡º
- æ•°æ®åŒæ­¥: æœ¬åœ°æ•°æ®å®æ—¶å­˜å‚¨ï¼›åœ¨è”ç½‘çŠ¶æ€ä¸‹ï¼Œå¯ä»¥é€šè¿‡äº‘ç«¯åŒæ­¥æ•°æ®ï¼Œæ”¯æŒæ‰‹åŠ¨å…¨é‡åŒæ­¥ã€è‡ªåŠ¨å¢é‡åŒæ­¥



## æ•°æ®ç»“æ„
é€šè¿‡ç»„åˆ«ç®¡ç†ä»»åŠ¡ï¼š`group(ç»„åˆ«)` > `task(ä»»åŠ¡)`

### æ•°æ®å®šä¹‰
``` txt
group
|- name: <string>
|- icon: <string> (emoji)
|- color: <flutter.primaryColor> (random)
|- tasks: [<task>]

task
|- title: <string>
|- summary: <string?>
|- start_time: <datetime(int)?>
|- start_time_precision: <enum(int)?>
|- end_time: <datetime(int)?>
|- end_time_precision: <enum(int)?>
|- importance: <int?> 1-5
|- location: <string?>
|- participant: <string?>
|- note: <string?>
|- source: <string?> (åŸæ–‡åœ°å€ï¼Œç”¨æˆ·è¾“å…¥ä¸ºç©º)
|- content: <string?>
|- status: <enum(int)> 1(æœªå®Œæˆ) 2(å·²å®Œæˆ)
...
```

`time_precision` å­—æ®µ:
| çŠ¶æ€ | è¡¨ç¤º |
| --- | --- |
| 0 | å¹´ |
| 1 | æœˆ |
| 2 | æ—¥ |
| 3 | æ—¶ |
| 4 | åˆ† |
| 5 | ç§’ |


### æ•°æ®å­˜å‚¨
- æœ¬åœ°é‡‡ç”¨ `ProtoBuf` è¿›è¡ŒäºŒè¿›åˆ¶ç¼–ç åå­˜å‚¨
- äº‘ç«¯é‡‡ç”¨ `Json` è¿›è¡Œæ–‡æœ¬ç¼–ç åå­˜å‚¨

## AIéƒ¨åˆ†
### ç³»ç»Ÿæç¤ºè¯

``` txt
ç”¨æˆ·å°†æä¾›ç»™ä½ ä¸€æ®µä¿¡æ¯ï¼Œè¯·ä½ åˆ†æè¿™æ®µä¿¡æ¯æ˜¯å¦åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªäº‹ä»¶ï¼Œå¹¶æŒ‰ç…§æ‹¬å·å†…çš„è¦æ±‚æå–å…³é”®ä¿¡æ¯ï¼Œè‹¥æ˜¯ï¼Œåˆ™ä»¥ JSON çš„å½¢å¼è¾“å‡ºï¼Œè¾“å‡ºçš„ JSON éœ€éµå®ˆä»¥ä¸‹çš„æ ¼å¼ï¼š

[
    {
        "title": <äº‹ä»¶æ ‡é¢˜>(string),
        "summary": <äº‹ä»¶æ¦‚å†µ>(string),
        "startTime": <äº‹ä»¶å¼€å§‹æ—¶é—´æˆ³>(int),
        "startTimePrecision": <æ—¶é—´å¼€å§‹çš„æ—¶é—´æˆ³ç±»å‹>(int), 
        "endTime": <äº‹ä»¶ç»“æŸæ—¶é—´æˆ³>(int?),
        "endTimePrecision": <æ—¶é—´ç»“æŸçš„æ—¶é—´æˆ³ç±»å‹>(int?),
        "importance": <äº‹ä»¶é‡è¦æ€§ï¼Œæ•°æ®ä¸º:1(ä¸é‡è¦)-5(å¾ˆé‡è¦)>(int?),
        "location": <äº‹ä»¶å‘ç”Ÿåœ°ç‚¹>(string?),
        "participant": <äº‹ä»¶å‚ä¸å¯¹è±¡>(string?),
        "note": <äº‹ä»¶å¤‡æ³¨>(string?),
    },
    ...
]

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ"startTimePrecision" å’Œ "endTimePrecision" çš„å€¼ä¸ºintï¼Œåˆ†åˆ«è¡¨ç¤ºæ—¶é—´æˆ³çš„ç²¾åº¦ï¼Œ0è¡¨ç¤ºç²¾ç¡®åˆ°å¹´ï¼Œ1è¡¨ç¤ºç²¾ç¡®åˆ°æœˆï¼Œ2è¡¨ç¤ºç²¾ç¡®åˆ°æ—¥ï¼Œ3è¡¨ç¤ºç²¾ç¡®åˆ°æ—¶ï¼Œ4è¡¨ç¤ºç²¾ç¡®åˆ°åˆ†ï¼Œ5è¡¨ç¤ºç²¾ç¡®åˆ°ç§’ã€‚

æ­¤å¤–ï¼Œå°æ‹¬å·å†…æ ‡æ³¨çš„æ˜¯ç±»å‹ï¼Œå¸¦æœ‰"?"çš„è¡¨ç¤ºè¯¥å±æ€§å¯ä»¥ä¸º null

è‹¥æ®µä¿¡æ¯ä¸åŒ…å«ä»»ä½•äº‹ä»¶ï¼Œåˆ™è¾“å‡º []ã€‚
``` 

## ç¼–è¯‘ç›¸å…³
### ProtoBuf ç¼–è¯‘

``` sh
protoc --proto_path=lib/data/proto --dart_out=lib/data/proto.gen group.proto task.proto user.proto storage.proto
```

### æ•°æ®åº“

æ•°æ®åº“è¡¨å®šä¹‰ï¼š
``` sql
create table public.users (
  id bigint generated by default as identity not null,
  constraint users_pkey primary key (id)
) TABLESPACE pg_default;

create table public.groups (
  id bigint generated by default as identity not null,
  "userId" bigint not null,
  "updateAt" bigint not null,
  data jsonb null,
  constraint groups_pkey primary key (id, "userId"),
  constraint groups_userid_fkey foreign KEY ("userId") references users (id)
) TABLESPACE pg_default;

create table public.tasks (
  "userId" bigint not null,
  id bigint generated by default as identity not null,
  "updateAt" bigint not null,
  data jsonb null,
  constraint tasks_pkey primary key ("userId", id),
  constraint tasks_userid_fkey foreign KEY ("userId") references users (id)
) TABLESPACE pg_default;

create table public.user_info_phone (
  id bigint generated by default as identity not null,
  "userId" bigint null,
  phone bigint not null,
  constraint user_info_phone_pkey primary key (id),
  constraint user_info_phone_userid_fkey foreign KEY ("userId") references users (id) on delete CASCADE
) TABLESPACE pg_default;

create table public.user_info_wechat (
  id bigint generated by default as identity not null,
  "userId" bigint not null,
  openid text not null,
  constraint user_info_wechat_pkey primary key (id),
  constraint user_info_wechat_openid_key unique (openid),
  constraint user_info_wechat_userId_fkey foreign KEY ("userId") references users (id)
) TABLESPACE pg_default;

create table public.qr_login_request (
  id bigint generated by default as identity not null,
  "userId" bigint null,
  token uuid not null default gen_random_uuid (),
  "requestAt" timestamp with time zone not null default (now() AT TIME ZONE 'utc'::text),
  constraint qr_login_request_pkey primary key (id),
  constraint qr_login_request_token_key unique (token),
  constraint qr_login_request_userid_fkey foreign KEY ("userId") references users (id)
) TABLESPACE pg_default;
```

æ•°æ®åº“å®šæ—¶ä»»åŠ¡:
``` sql
CREATE EXTENSION IF NOT EXISTS pg_cron;
SELECT cron.schedule('*/20 * * * *', $$DELETE FROM qr_login_request WHERE "requestAt" < NOW() - INTERVAL '40 minutes'$$);
```

## å¤‡æ³¨
### QRç™»é™†ä¿¡æ¯
ç¼–ç : `http://todo.zinc233.top/qrlogin?token=<token>`